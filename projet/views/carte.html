<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Visualiser les différentes parcelles </title>
    <link rel="stylesheet" href="./../assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="./../assets/css/leaflet.css">
</head>

<body>

<div id="map" style="height:100%;"></div>

<script src="./../assets/js/jquery-3.2.1.min.js"></script>
<script src="./../assets/js/bootstrap.min.js"></script>
<script src="./../assets/js/popper.min.js"></script>
<script src="./../assets/js/leaflet.js"></script>
<script>
    var map;
    /* initialisation de la fonction initmap */
    function initmap() {
        // paramÃƒÂ©trage de la carte
        map = new L.Map('map');
        // crÃƒÂ©ation des "tiles" avec open street map
        var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
        var osmAttrib='Map data de OpenStreetMap';
        var osm = new L.TileLayer(osmUrl, {minZoom: 2, maxZoom: 20, attribution: osmAttrib});           
        // on centre sur le Benin
        map.setView(new L.LatLng(6.366667, 2.433333),14);
        map.addLayer(osm);          
    }
    /* on va procédé à  l'initialisation de la carte */
    initmap();

    /* Creation d'un tableau qui va contenir nos donnes */
    var tableau = [];
    var localisationTableau = [] ;
    //Récupération des données depuis le fichier de données
    /* Creation d'un tableau qui va contenir nos donnes */

    var tableau = [];
    var localisationTableau = [] ;
    //Récupération des données depuis le fichier de données
    $.ajax({
        url : './../controllers/getCoordinates.php', // La ressource ciblée
        type : 'GET', // Le type de la requête HTTP.
        success : function(data){ // code_html contient le HTML renvoyé
            localisations = JSON.parse(data)
            tableau.push(localisations)
            tableau.forEach((element , index) => {
                localisationTableau.push([element.longitude_b1 , element.latitude_b1 , element.longitude_b2 , element.latitude_b2 , element.longitude_b3 , element.latitude_b3 , element.longitude_b4 , element.latitude_b4])
            });
            
            for (i = 0; i < localisationTableau.length ; i++) {
                // Red icon
                couleur = "red"
                var redIcon = new L.Icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
                });
                // On crée un markeur pour la localisation
                console.log(localisationTableau)
                let marker  = L.marker([localisationTableau[i][1], localisationTableau[i][0]], {icon : redIcon}).addTo(map)
                let marker2 = L.marker([localisationTableau[i][3], localisationTableau[i][2]], {icon : redIcon}).addTo(map)
                let marker3 = L.marker([localisationTableau[i][5], localisationTableau[i][4]], {icon : redIcon}).addTo(map)
                let marker4 = L.marker([localisationTableau[i][7], localisationTableau[i][6]], {icon : redIcon}).addTo(map)
                /*
                * On va créer un cercle sur la carte pour chaque point
                */
            }
        
        },
        error : function(error) {
            console.log(error)
        },
        complete : function(){

        }
    })
</script>
</body>
</html>